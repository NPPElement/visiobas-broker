{"filter":false,"title":"zap1.php","tooltip":"/zap1.php","undoManager":{"mark":47,"position":47,"stack":[[{"start":{"row":9,"column":13},"end":{"row":9,"column":14},"action":"insert","lines":["0"],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":3}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["<"],"id":4}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["p"],"id":5}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["r"],"id":6}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["e"],"id":7}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":11},"action":"insert","lines":["></pre>"],"id":8}],[{"start":{"row":0,"column":5},"end":{"row":0,"column":11},"action":"remove","lines":["</pre>"],"id":9}],[{"start":{"row":10,"column":12},"end":{"row":10,"column":14},"action":"remove","lines":["10"],"id":10},{"start":{"row":10,"column":12},"end":{"row":10,"column":13},"action":"insert","lines":["5"]}],[{"start":{"row":10,"column":13},"end":{"row":10,"column":14},"action":"insert","lines":["8"],"id":11}],[{"start":{"row":132,"column":72},"end":{"row":132,"column":73},"action":"insert","lines":["0"],"id":12}],[{"start":{"row":132,"column":75},"end":{"row":132,"column":77},"action":"remove","lines":["12"],"id":13},{"start":{"row":132,"column":75},"end":{"row":132,"column":76},"action":"insert","lines":["5"]}],[{"start":{"row":132,"column":76},"end":{"row":132,"column":77},"action":"insert","lines":["0"],"id":14}],[{"start":{"row":0,"column":0},"end":{"row":150,"column":0},"action":"remove","lines":["<pre>","<?php","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    zapravkaReset();","    unlink(F_ZSTATE);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":15},{"start":{"row":0,"column":0},"end":{"row":153,"column":0},"action":"insert","lines":["<?php","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 1;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(5);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(1, 12);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":10,"column":12},"end":{"row":10,"column":13},"action":"remove","lines":["1"],"id":16},{"start":{"row":10,"column":12},"end":{"row":10,"column":13},"action":"insert","lines":["5"]}],[{"start":{"row":10,"column":13},"end":{"row":10,"column":14},"action":"insert","lines":["8"],"id":17}],[{"start":{"row":135,"column":72},"end":{"row":135,"column":73},"action":"insert","lines":["0"],"id":18}],[{"start":{"row":135,"column":75},"end":{"row":135,"column":77},"action":"remove","lines":["12"],"id":19},{"start":{"row":135,"column":75},"end":{"row":135,"column":76},"action":"insert","lines":["5"]}],[{"start":{"row":135,"column":76},"end":{"row":135,"column":77},"action":"insert","lines":["0"],"id":20}],[{"start":{"row":0,"column":0},"end":{"row":153,"column":0},"action":"remove","lines":["<?php","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(5);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":21},{"start":{"row":0,"column":0},"end":{"row":153,"column":0},"action":"insert","lines":["<?php","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":153,"column":0},"action":"remove","lines":["<?php","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":22},{"start":{"row":0,"column":0},"end":{"row":156,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":137,"column":0},"end":{"row":142,"column":0},"action":"remove","lines":["            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }",""],"id":24},{"start":{"row":137,"column":0},"end":{"row":143,"column":0},"action":"insert","lines":["            else {","                if ($k==1 && !$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($k==1 && $info[\"nextTo\"] < time()) initZap($k);","                }","            }",""]}],[{"start":{"row":142,"column":0},"end":{"row":143,"column":0},"action":"remove","lines":["            }",""],"id":25}],[{"start":{"row":0,"column":0},"end":{"row":156,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if ($k==1 && !$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($k==1 && $info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":26},{"start":{"row":0,"column":0},"end":{"row":164,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":164,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":27},{"start":{"row":0,"column":0},"end":{"row":184,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":184,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":28},{"start":{"row":0,"column":0},"end":{"row":186,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":186,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":29},{"start":{"row":0,"column":0},"end":{"row":193,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":193,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":30},{"start":{"row":0,"column":0},"end":{"row":195,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","    usleep(1000*500);","    setTimeStamp();","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":195,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","    usleep(1000*500);","    setTimeStamp();","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":31},{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":32},{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":33},{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":34},{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"95\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"95\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":35},{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":36},{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":37},{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":38},{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":158,"column":0},"end":{"row":158,"column":1},"action":"remove","lines":["/"],"id":39}],[{"start":{"row":158,"column":0},"end":{"row":158,"column":1},"action":"remove","lines":["/"],"id":40}],[{"start":{"row":192,"column":0},"end":{"row":192,"column":1},"action":"remove","lines":["/"],"id":41}],[{"start":{"row":192,"column":0},"end":{"row":192,"column":1},"action":"remove","lines":["/"],"id":42}],[{"start":{"row":192,"column":0},"end":{"row":192,"column":1},"action":"insert","lines":["/"],"id":43}],[{"start":{"row":192,"column":1},"end":{"row":192,"column":2},"action":"insert","lines":["/"],"id":44}],[{"start":{"row":158,"column":4},"end":{"row":158,"column":5},"action":"insert","lines":["/"],"id":45}],[{"start":{"row":158,"column":5},"end":{"row":158,"column":6},"action":"insert","lines":["/"],"id":46}],[{"start":{"row":158,"column":6},"end":{"row":158,"column":7},"action":"insert","lines":[" "],"id":47}],[{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    // $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":48},{"start":{"row":0,"column":0},"end":{"row":222,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":222,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":49},{"start":{"row":0,"column":0},"end":{"row":246,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if( !is_file($f.\".tank\") && isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","        }","","        for($f=1;$f<=3;$f++) {","            setTankRashod($f, calcFuelRashod($f));","            $m = [1=>\"98\",2=>\"95\",3=>\"DT\"];","            $marka = $m[$f];","","            if(is_file($marka.\".tank\")) {","                $from_time = 0+file_get_contents($marka.\".tank\");","                $tankVolume = getTankVolume($marka);","                if($from_time>time()) {","                    if($tankVolume<MAX_FUEL_LEVEL) {","                        $newVolume = $tankVolume + 100;","                        if ($newVolume >= MAX_FUEL_LEVEL) {","                            $newVolume = MAX_FUEL_LEVEL;","                            file_put_contents($marka . \".tank\", time() + 20);","                        }","                        setTankVolume($marka, $newVolume);","                    } else {","                        unlink($marka . \".tank\");","                    }","                }","            }","","","        }","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":246,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if( !is_file($f.\".tank\") && isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","        }","","        for($f=1;$f<=3;$f++) {","            setTankRashod($f, calcFuelRashod($f));","            $m = [1=>\"98\",2=>\"95\",3=>\"DT\"];","            $marka = $m[$f];","","            if(is_file($marka.\".tank\")) {","                $from_time = 0+file_get_contents($marka.\".tank\");","                $tankVolume = getTankVolume($marka);","                if($from_time>time()) {","                    if($tankVolume<MAX_FUEL_LEVEL) {","                        $newVolume = $tankVolume + 100;","                        if ($newVolume >= MAX_FUEL_LEVEL) {","                            $newVolume = MAX_FUEL_LEVEL;","                            file_put_contents($marka . \".tank\", time() + 20);","                        }","                        setTankVolume($marka, $newVolume);","                    } else {","                        unlink($marka . \".tank\");","                    }","                }","            }","","","        }","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":50},{"start":{"row":0,"column":0},"end":{"row":247,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        $vol1 = round($vol1, 2);","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if( !is_file($f.\".tank\") && isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","        }","","        for($f=1;$f<=3;$f++) {","            setTankRashod($f, calcFuelRashod($f));","            $m = [1=>\"98\",2=>\"95\",3=>\"DT\"];","            $marka = $m[$f];","","            if(is_file($marka.\".tank\")) {","                $from_time = 0+file_get_contents($marka.\".tank\");","                $tankVolume = getTankVolume($marka);","                if($from_time>time()) {","                    if($tankVolume<MAX_FUEL_LEVEL) {","                        $newVolume = $tankVolume + 100;","                        if ($newVolume >= MAX_FUEL_LEVEL) {","                            $newVolume = MAX_FUEL_LEVEL;","                            file_put_contents($marka . \".tank\", time() + 20);","                        }","                        setTankVolume($marka, $newVolume);","                    } else {","                        unlink($marka . \".tank\");","                    }","                }","            }","","","        }","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}]]},"ace":{"folds":[],"scrolltop":2731,"scrollleft":0,"selection":{"start":{"row":222,"column":27},"end":{"row":222,"column":27},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":194,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1613505307398,"hash":"267599dfa546c7b8768b68bae0ce4bccc3ce1fab"}