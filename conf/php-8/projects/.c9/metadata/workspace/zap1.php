{"changed":false,"filter":false,"title":"zap1.php","tooltip":"/zap1.php","undoManager":{"mark":52,"position":52,"stack":[[{"start":{"row":9,"column":13},"end":{"row":9,"column":14},"action":"insert","lines":["0"],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":3}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["<"],"id":4}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["p"],"id":5}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["r"],"id":6}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["e"],"id":7}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":11},"action":"insert","lines":["></pre>"],"id":8}],[{"start":{"row":0,"column":5},"end":{"row":0,"column":11},"action":"remove","lines":["</pre>"],"id":9}],[{"start":{"row":10,"column":12},"end":{"row":10,"column":14},"action":"remove","lines":["10"],"id":10},{"start":{"row":10,"column":12},"end":{"row":10,"column":13},"action":"insert","lines":["5"]}],[{"start":{"row":10,"column":13},"end":{"row":10,"column":14},"action":"insert","lines":["8"],"id":11}],[{"start":{"row":132,"column":72},"end":{"row":132,"column":73},"action":"insert","lines":["0"],"id":12}],[{"start":{"row":132,"column":75},"end":{"row":132,"column":77},"action":"remove","lines":["12"],"id":13},{"start":{"row":132,"column":75},"end":{"row":132,"column":76},"action":"insert","lines":["5"]}],[{"start":{"row":132,"column":76},"end":{"row":132,"column":77},"action":"insert","lines":["0"],"id":14}],[{"start":{"row":0,"column":0},"end":{"row":150,"column":0},"action":"remove","lines":["<pre>","<?php","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    zapravkaReset();","    unlink(F_ZSTATE);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":15},{"start":{"row":0,"column":0},"end":{"row":153,"column":0},"action":"insert","lines":["<?php","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 1;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(5);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(1, 12);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":10,"column":12},"end":{"row":10,"column":13},"action":"remove","lines":["1"],"id":16},{"start":{"row":10,"column":12},"end":{"row":10,"column":13},"action":"insert","lines":["5"]}],[{"start":{"row":10,"column":13},"end":{"row":10,"column":14},"action":"insert","lines":["8"],"id":17}],[{"start":{"row":135,"column":72},"end":{"row":135,"column":73},"action":"insert","lines":["0"],"id":18}],[{"start":{"row":135,"column":75},"end":{"row":135,"column":77},"action":"remove","lines":["12"],"id":19},{"start":{"row":135,"column":75},"end":{"row":135,"column":76},"action":"insert","lines":["5"]}],[{"start":{"row":135,"column":76},"end":{"row":135,"column":77},"action":"insert","lines":["0"],"id":20}],[{"start":{"row":0,"column":0},"end":{"row":153,"column":0},"action":"remove","lines":["<?php","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(5);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":21},{"start":{"row":0,"column":0},"end":{"row":153,"column":0},"action":"insert","lines":["<?php","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":153,"column":0},"action":"remove","lines":["<?php","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":22},{"start":{"row":0,"column":0},"end":{"row":156,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":137,"column":0},"end":{"row":142,"column":0},"action":"remove","lines":["            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }",""],"id":24},{"start":{"row":137,"column":0},"end":{"row":143,"column":0},"action":"insert","lines":["            else {","                if ($k==1 && !$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($k==1 && $info[\"nextTo\"] < time()) initZap($k);","                }","            }",""]}],[{"start":{"row":142,"column":0},"end":{"row":143,"column":0},"action":"remove","lines":["            }",""],"id":25}],[{"start":{"row":0,"column":0},"end":{"row":156,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if ($k==1 && !$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($k==1 && $info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":26},{"start":{"row":0,"column":0},"end":{"row":164,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":164,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":27},{"start":{"row":0,"column":0},"end":{"row":184,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":184,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":28},{"start":{"row":0,"column":0},"end":{"row":186,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":186,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":29},{"start":{"row":0,"column":0},"end":{"row":193,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":193,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":30},{"start":{"row":0,"column":0},"end":{"row":195,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","    usleep(1000*500);","    setTimeStamp();","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":195,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","    usleep(1000*500);","    setTimeStamp();","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":31},{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=1) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":32},{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":33},{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"98\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":34},{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"95\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"95\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=2) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":35},{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":198,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","        }","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":36},{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":37},{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":38},{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":158,"column":0},"end":{"row":158,"column":1},"action":"remove","lines":["/"],"id":39}],[{"start":{"row":158,"column":0},"end":{"row":158,"column":1},"action":"remove","lines":["/"],"id":40}],[{"start":{"row":192,"column":0},"end":{"row":192,"column":1},"action":"remove","lines":["/"],"id":41}],[{"start":{"row":192,"column":0},"end":{"row":192,"column":1},"action":"remove","lines":["/"],"id":42}],[{"start":{"row":192,"column":0},"end":{"row":192,"column":1},"action":"insert","lines":["/"],"id":43}],[{"start":{"row":192,"column":1},"end":{"row":192,"column":2},"action":"insert","lines":["/"],"id":44}],[{"start":{"row":158,"column":4},"end":{"row":158,"column":5},"action":"insert","lines":["/"],"id":45}],[{"start":{"row":158,"column":5},"end":{"row":158,"column":6},"action":"insert","lines":["/"],"id":46}],[{"start":{"row":158,"column":6},"end":{"row":158,"column":7},"action":"insert","lines":[" "],"id":47}],[{"start":{"row":0,"column":0},"end":{"row":221,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $volume / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","    // $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":48},{"start":{"row":0,"column":0},"end":{"row":222,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":222,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if(isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","            setTankRashod($k, calcFuelRashod($k));","        }","","","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":49},{"start":{"row":0,"column":0},"end":{"row":246,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if( !is_file($f.\".tank\") && isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","        }","","        for($f=1;$f<=3;$f++) {","            setTankRashod($f, calcFuelRashod($f));","            $m = [1=>\"98\",2=>\"95\",3=>\"DT\"];","            $marka = $m[$f];","","            if(is_file($marka.\".tank\")) {","                $from_time = 0+file_get_contents($marka.\".tank\");","                $tankVolume = getTankVolume($marka);","                if($from_time>time()) {","                    if($tankVolume<MAX_FUEL_LEVEL) {","                        $newVolume = $tankVolume + 100;","                        if ($newVolume >= MAX_FUEL_LEVEL) {","                            $newVolume = MAX_FUEL_LEVEL;","                            file_put_contents($marka . \".tank\", time() + 20);","                        }","                        setTankVolume($marka, $newVolume);","                    } else {","                        unlink($marka . \".tank\");","                    }","                }","            }","","","        }","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":246,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if( !is_file($f.\".tank\") && isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","        }","","        for($f=1;$f<=3;$f++) {","            setTankRashod($f, calcFuelRashod($f));","            $m = [1=>\"98\",2=>\"95\",3=>\"DT\"];","            $marka = $m[$f];","","            if(is_file($marka.\".tank\")) {","                $from_time = 0+file_get_contents($marka.\".tank\");","                $tankVolume = getTankVolume($marka);","                if($from_time>time()) {","                    if($tankVolume<MAX_FUEL_LEVEL) {","                        $newVolume = $tankVolume + 100;","                        if ($newVolume >= MAX_FUEL_LEVEL) {","                            $newVolume = MAX_FUEL_LEVEL;","                            file_put_contents($marka . \".tank\", time() + 20);","                        }","                        setTankVolume($marka, $newVolume);","                    } else {","                        unlink($marka . \".tank\");","                    }","                }","            }","","","        }","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":50},{"start":{"row":0,"column":0},"end":{"row":247,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        $vol1 = round($vol1, 2);","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if( !is_file($f.\".tank\") && isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","        }","","        for($f=1;$f<=3;$f++) {","            setTankRashod($f, calcFuelRashod($f));","            $m = [1=>\"98\",2=>\"95\",3=>\"DT\"];","            $marka = $m[$f];","","            if(is_file($marka.\".tank\")) {","                $from_time = 0+file_get_contents($marka.\".tank\");","                $tankVolume = getTankVolume($marka);","                if($from_time>time()) {","                    if($tankVolume<MAX_FUEL_LEVEL) {","                        $newVolume = $tankVolume + 100;","                        if ($newVolume >= MAX_FUEL_LEVEL) {","                            $newVolume = MAX_FUEL_LEVEL;","                            file_put_contents($marka . \".tank\", time() + 20);","                        }","                        setTankVolume($marka, $newVolume);","                    } else {","                        unlink($marka . \".tank\");","                    }","                }","            }","","","        }","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":161,"column":0},"end":{"row":161,"column":2},"action":"remove","lines":["//"],"id":51}],[{"start":{"row":161,"column":15},"end":{"row":161,"column":17},"action":"remove","lines":["DT"],"id":52},{"start":{"row":161,"column":15},"end":{"row":161,"column":16},"action":"insert","lines":["9"]}],[{"start":{"row":161,"column":16},"end":{"row":161,"column":17},"action":"insert","lines":["5"],"id":53}],[{"start":{"row":161,"column":4},"end":{"row":161,"column":7},"action":"insert","lines":["// "],"id":55}],[{"start":{"row":0,"column":0},"end":{"row":247,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        $vol1 = round($vol1, 2);","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $vol = randFuelVolume();","    $fuels = [\"98\",\"95\",\"DT\"];","","    // $fuels = [\"95\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) if( !is_file($f.\".tank\") && isFuel($f, $vol)) {$type=normT($f); break; }","    if(!$type) return false;","","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=>rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","        }","","        for($f=1;$f<=3;$f++) {","            setTankRashod($f, calcFuelRashod($f));","            $m = [1=>\"98\",2=>\"95\",3=>\"DT\"];","            $marka = $m[$f];","","            if(is_file($marka.\".tank\")) {","                $from_time = 0+file_get_contents($marka.\".tank\");","                $tankVolume = getTankVolume($marka);","                if($from_time>time()) {","                    if($tankVolume<MAX_FUEL_LEVEL) {","                        $newVolume = $tankVolume + 100;","                        if ($newVolume >= MAX_FUEL_LEVEL) {","                            $newVolume = MAX_FUEL_LEVEL;","                            file_put_contents($marka . \".tank\", time() + 20);","                        }","                        setTankVolume($marka, $newVolume);","                    } else {","                        unlink($marka . \".tank\");","                    }","                }","            }","","","        }","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":56},{"start":{"row":0,"column":0},"end":{"row":250,"column":0},"action":"insert","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        $vol1 = round($vol1, 2);","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $fuels = [\"98\",\"95\",\"DT\", \"95\"];","","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) {","        $vol = randFuelVolume($f===\"DT\");","        if( !is_file($f.\".tank\") && isFuel($f, $vol)) {$type=normT($f); break; }","    }","    if(!$type) return false;","","    $typeDT = normT(\"DT\");","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=> $typeDT==$type ?  rand(40,100)/10 :  rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","        }","","        for($f=1;$f<=3;$f++) {","            setTankRashod($f, calcFuelRashod($f));","            $m = [1=>\"98\",2=>\"95\",3=>\"DT\"];","            $marka = $m[$f];","","            if(is_file($marka.\".tank\")) {","                $from_time = 0+file_get_contents($marka.\".tank\");","                $tankVolume = getTankVolume($marka);","                if($from_time>time()) {","                    if($tankVolume<MAX_FUEL_LEVEL) {","                        $newVolume = $tankVolume + 100;","                        if ($newVolume >= MAX_FUEL_LEVEL) {","                            $newVolume = MAX_FUEL_LEVEL;","                            file_put_contents($marka . \".tank\", time() + 20);","                        }","                        setTankVolume($marka, $newVolume);","                    } else {","                        unlink($marka . \".tank\");","                    }","                }","            }","","","        }","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""]}],[{"start":{"row":0,"column":0},"end":{"row":250,"column":0},"action":"remove","lines":["<?php","","header(\"Content-Type: text/plain; charset=utf-8\");","","","if(isset($_GET['ping'])) {","","    exit(\"Ping...\\n-----------\");","}","","","","require_once __DIR__.\"/zap_func.php\";","","define(\"F_ZSTATE\", \"z_state.json\");","define(\"F_FUEL_SPEED\", \"z_fuel.json\");","define(\"F_STOP\", \".stop\");","define(\"_DELAY_POMP\", 2);","define(\"_DELAY_GUN_INACTIVCATE\", 3);","","$max_time = 58;","$start = time();","","if(is_file(F_ZSTATE) && strlen($jc=file_get_contents(F_ZSTATE))>8) {","    $z = json_decode($jc, true);","} else {","    $z = [","        1 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        2 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","        3 => [","            \"zak\" => 0,","            \"speed\" => 0,","            \"ready\" => 0,","            \"type\" => false,","            \"time\"=>0,","            \"nextTo\"=>0","        ],","    ];","}","","","if(isset($_GET['report'])) {","    print_r($z);","    exit(\"\\n-----------\");","}","","if(isset($_GET['stop'])) {","    echo \"STOP action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    unlink(F_ZSTATE);","    exit(\"\\n-----------\");","}","","","if(isset($_GET['pause'])) {","    echo \"PAUSE action\";","    file_put_contents(F_STOP, date(\"r\"));","    sleep(10);","    exit(\"\\n-----------\");","}","","if(isset($_GET['start'])) {","    echo \"START action\";","    unlink(F_STOP);","    exit(\"\\n-----------\");","}","","global $fuel_sp;","if(is_file(F_FUEL_SPEED) && strlen($jc=file_get_contents(F_FUEL_SPEED))>8) {","    $fuel_sp = json_decode($jc, true);","} else {","    $fuel_sp = [ 1=>[], 2=>[], 3=>[], ];","}","","","","function calcFuelRashod($k) {","    global $fuel_sp;","    $rashod = 0;","    $now_ms = 1000*microtime(true);","    $from_time = $now_ms - 1000*60*60;","    $past_time =  $now_ms;","    foreach ($fuel_sp[$k] as $time=>$volume) {","        $time = 1.0*$time;","        if($time<$from_time) continue;","        if($past_time>$time) $past_time=$time;","        $rashod+=$volume;","    }","","    $dT_ns = $now_ms-$past_time;","    if($dT_ns==0) return 0;","    $rashod_hour = $rashod / ( $dT_ns/(1000*60*60) );","    return $rashod_hour;","}","","","function serviceZak($k) {","    global $z;","    global $fuel_sp;","    $info = $z[$k];","    $dT = time()-$info['time'];","    if($dT==0) return;","","    if($info['ready'] ==-1) {","        if(time()-$info['time']>=_DELAY_POMP) {","            setKolonkaVolume($k, 0);","            $z[$k]['ready'] = 0;","            $z[$k]['time'] = time();","        }","        return;","    }","","    if($info['ready']<$info['zak']) {","        gunSetPomp($k, $info['type'], true);","        $vol1 = $info['speed'] * $dT;","        if($info['ready']+$vol1<=$info['zak']) {","            $z[$k]['ready'] = $info['ready']+$vol1;","            $z[$k]['time'] = time();","        } else {","            $vol1 = $info['zak']-$z[$k]['ready'];","            $z[$k]['ready'] = $info['zak'];","            $z[$k]['time'] = time();","        }","        $vol1 = round($vol1, 2);","        tankSub($info['type'], $vol1);","        $fuel_sp[$info['type']][microtime(true)*1000] = $vol1;","        setKolonkaVolume($k, $z[$k]['ready']);","    }","","    if($z[$k]['ready']>=$z[$k]['zak']) {","        gunSetPomp($k, $info['type'], false);","","        if($dT>=_DELAY_GUN_INACTIVCATE) {","            gunInActivate($k, $info['type']);","            $z[$k]['zak'] = 0;","        }","    }","","}","","","function initZap($k) {","    global $z;","    $fuels = [\"98\",\"95\",\"DT\", \"95\"];","","//    $fuels = [\"DT\"];","    shuffle($fuels);","    $type = false;","    foreach ($fuels as $f) {","        $vol = randFuelVolume($f===\"DT\");","        if( !is_file($f.\".tank\") && isFuel($f, $vol)) {$type=normT($f); break; }","    }","    if(!$type) return false;","","    $typeDT = normT(\"DT\");","    $z[$k] = [","        \"zak\"=>$vol,","        \"type\"=>$type,","        \"ready\" => -1,","        \"speed\"=> $typeDT==$type ?  rand(40,100)/10 :  rand(20,50)/10, // litr/sec","        \"time\"=>time(),","        \"nextTo\"=>0","    ];","    gunActivate($k, $type);","    return true;","}","","","","if(isset($_GET['reset'])) {","    file_put_contents(F_STOP, date(\"r\"));","    sleep(20);","    zapravkaReset();","    unlink(F_ZSTATE);","    unlink(F_STOP);","    echo \"Перезагрузка\";","    setTimeStamp();","","} else {","","    while (time() - $start < $max_time && !is_file(F_STOP)) {","        $free = [];","","        foreach ($z as $k => $info) {","//            if($k!=3) continue;","            if ($info[\"zak\"]) serviceZak($k);","            else {","                if (!$info[\"nextTo\"]) $z[$k][\"nextTo\"] = time() + rand(10, 50);","                else {","                    if ($info[\"nextTo\"] < time()) initZap($k);","                }","            }","","        }","","        for($f=1;$f<=3;$f++) {","            setTankRashod($f, calcFuelRashod($f));","            $m = [1=>\"98\",2=>\"95\",3=>\"DT\"];","            $marka = $m[$f];","","            if(is_file($marka.\".tank\")) {","                $from_time = 0+file_get_contents($marka.\".tank\");","                $tankVolume = getTankVolume($marka);","                if($from_time>time()) {","                    if($tankVolume<MAX_FUEL_LEVEL) {","                        $newVolume = $tankVolume + 100;","                        if ($newVolume >= MAX_FUEL_LEVEL) {","                            $newVolume = MAX_FUEL_LEVEL;","                            file_put_contents($marka . \".tank\", time() + 20);","                        }","                        setTankVolume($marka, $newVolume);","                    } else {","                        unlink($marka . \".tank\");","                    }","                }","            }","","","        }","","        setTimeStamp();","        usleep(1000*500);","","    }","","","    print_r($z);","}","","file_put_contents(F_ZSTATE, json_encode($z));","file_put_contents(F_FUEL_SPEED, json_encode($fuel_sp));","echo \"\\n-----------------\\n\\n\";","//print_r($sql_log);","echo \"sql time: $timeSql\\n\";","echo join(\"\\n\", $sql_log);",""],"id":57},{"start":{"row":0,"column":0},"end":{"row":196,"column":1},"action":"insert","lines":["<?php","","define(\"MAX_FUEL_LEVEL\", 2500);","","require_once __DIR__.\"/lib/mysql.php\";","","global $changedRef;","$changedRef = [];","global $za_config;","$za_config = [","    \"bak\"=>[","        \"98\"=>[\"volume\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.tank98_level\", \"rashod\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.sred_rashod_tank_1\"],","        \"95\"=>[\"volume\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.tank95_level\", \"rashod\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.sred_rashod_tank_2\"],","        \"DT\"=>[\"volume\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.tankDT_level\", \"rashod\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.sred_rashod_tank_3\"],","    ],","","    \"kolonka\"=>[","        [","            \"volume\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.post_1_litres\",","            \"pistol\"=>[","                \"98\"=>[\"activated\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_1_1_activated\",\"pomp\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_1_1_status\"],","                \"95\"=>[\"activated\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_1_2_activated\",\"pomp\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_1_2_status\"],","                \"DT\"=>[\"activated\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_1_3_activated\",\"pomp\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_1_3_status\"],","            ]","        ],","        [","            \"volume\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.post_2_litres\",","            \"pistol\"=>[","                \"98\"=>[\"activated\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_2_1_activated\",\"pomp\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_2_1_status\"],","                \"95\"=>[\"activated\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_2_2_activated\",\"pomp\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_2_2_status\"],","                \"DT\"=>[\"activated\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_2_3_activated\",\"pomp\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_2_3_status\"],","            ]","        ],","        [","            \"volume\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.post_3_litres\",","            \"pistol\"=>[","                \"98\"=>[\"activated\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_3_1_activated\",\"pomp\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_3_1_status\"],","                \"95\"=>[\"activated\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_3_2_activated\",\"pomp\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_3_2_status\"],","                \"DT\"=>[\"activated\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_3_3_activated\",\"pomp\"=>\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_3_3_status\"],","            ]","        ],","","","","    ]","];","","","function wr($s) {","    echo $s.\"\\n\";","}","","","","function getValue($reference) {","    $r = getRecord(\"select * from objects where Object_Name='\".$reference.\"'\");","    $res =  is_array($r) ? $r['value'] : false;","//    wr(\"> $res\\t$reference\");","    return $res;","}","","","function setValue($reference, $value) {","    global $changedRef;","    $changedRef[]=$reference;","//    query(\"update objects set `value`=$value, `timestamp`=NOW() WHERE Object_Name='\".$reference.\"'\");","    query(\"update objects set `value`=$value WHERE Object_Name='\".$reference.\"'\");","//    wr(\"[$value] \\t => $reference\");","}","","","function randFuelVolume($maxi = false) {","    $vols = $maxi ? [20,50,80,120,200,300] :  [20,50,80,120];","    $vol = $vols[array_rand($vols)];","    return $vol;","}","","function isFuel($marka, $volume=0) {","    $m = [1=>\"98\",2=>\"95\",3=>\"DT\"]; if(isset($m[$marka])) $marka = $m[$marka];","","    $value = getTankVolume($marka);","    $existsFuel =  $value-$volume > 0.1*MAX_FUEL_LEVEL;","","    if(!$existsFuel && !is_file($marka.\".tank\")) {","        file_put_contents( $marka.\".tank\", time() + rand(50,600));","    }","","    if($existsFuel && is_file($marka.\".tank\") && (time()-filemtime($marka.\".tank\")>60*5) ) unlink($marka.\".tank\");","","    return $existsFuel;","}","","function getTankVolume($marka) {","    $m = [1=>\"98\",2=>\"95\",3=>\"DT\"]; if(isset($m[$marka])) $marka = $m[$marka];","    return getValue(\"Site:PETROL-STATIONS/PETROL-STATION_1.tank\" . $marka . \"_level\");","}","","function setTankVolume($marka, $volume) {","    $m = [1=>\"98\",2=>\"95\",3=>\"DT\"]; if(isset($m[$marka])) $marka = $m[$marka];","    setValue(\"Site:PETROL-STATIONS/PETROL-STATION_1.tank\" . $marka . \"_level\", round($volume, 2));","}","function setTankRashod($marka_or_type, $rashod) {","    $type = normT($marka_or_type);","    setValue(\"Site:PETROL-STATIONS/PETROL-STATION_1.sred_rashod_tank_$type\", $rashod);","}","","function tankAdd($marka, $volume) {","","    $m = [1=>\"98\",2=>\"95\",3=>\"DT\"]; if(isset($m[$marka])) $marka = $m[$marka];","    $sql = \"update objects set `value`=`value`+$volume where Object_Name='Site:PETROL-STATIONS/PETROL-STATION_1.tank\" . $marka . \"_level'\";","    global $changedRef;","    $changedRef[]=\"Site:PETROL-STATIONS/PETROL-STATION_1.tank\" . $marka . \"_level\";","","//    $sql = \"update objects set `value`=`value`+$volume, `timestamp`=NOW() where Object_Name='Site:PETROL-STATIONS/PETROL-STATION_1.tank\" . $marka . \"_level'\";","    query($sql);","}","","function tankSub($marka, $volume) {","    $m = [1=>\"98\",2=>\"95\",3=>\"DT\"]; if(isset($m[$marka])) $marka = $m[$marka];","    $sql = \"update objects set `value`=`value`-$volume where Object_Name='Site:PETROL-STATIONS/PETROL-STATION_1.tank\" . $marka . \"_level'\";","    global $changedRef;","    $changedRef[]=\"Site:PETROL-STATIONS/PETROL-STATION_1.tank\" . $marka . \"_level\";","","//    $sql = \"update objects set `value`=`value`-$volume, `timestamp`=NOW() where Object_Name='Site:PETROL-STATIONS/PETROL-STATION_1.tank\" . $marka . \"_level'\";","    query($sql);","}","","function normT($marka_or_idx) {","    $tr = [\"98\"=>1,\"95\"=>2,\"DT\"=>3];","    if(isset($tr[$marka_or_idx])) $marka_or_idx = $tr[$marka_or_idx];","    return $marka_or_idx;","}","","// kolonkaIdx - 1,2,3","// $marka_or_idx 98,95,DT or 1,2,3","function gunIsBusy($k, $marka_or_idx) {","    $marka_or_idx = normT($marka_or_idx);","    return getValue(\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_\".(0+$k).\"_\".$marka_or_idx.\"_activated\")!=0;","}","","function kolonkaIsBusy($idx) {","    for($f = 1;$f<=3;$f++) if(gunIsBusy($idx, $f)) return true;","    return false;","}","","function gunActivate($kol, $gun) {","    if(kolonkaIsBusy($kol)) return false;","    $gun = normT($gun);","    setValue(\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_\".(0+$kol).\"_\".$gun.\"_activated\", 1);","    for($g=1;$g<=3;$g++) if($g!=$gun) gunInActivate($kol, $g);","    return true;","}","","function gunInActivate($kol, $gun) {","    $gun = normT($gun);","    setValue(\"Site:PETROL-STATIONS/PETROL-STATION_1.gas_gun_\".(0+$kol).\"_\".$gun.\"_activated\", 0);","    return true;","}","","function gunSetPomp($kol, $gun, $value) {","    $gun = normT($gun);","    setValue(\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_\".(0+$kol).\"_\".$gun.\"_status\", $value?1:0);","    if($value) for($g=1;$g<=3;$g++) if($g!=$gun) gunSetPomp($kol, $g, false);","    return true;","}","","function gunGetPomp($kol, $gun) {","    $gun = normT($gun);","    return getValue(\"Site:PETROL-STATIONS/PETROL-STATION_1.pump_\".(0+$kol).\"_\".$gun.\"_status\") !=0;","}","","function setKolonkaVolume($k, $value) {","    setValue(\"Site:PETROL-STATIONS/PETROL-STATION_1.post_\".(0+$k).\"_litres\", $value);","}","","function setTimeStamp() {","    global $changedRef;","    $changedRef = array_unique($changedRef);","    if(count($changedRef)==0) return;","    $sql = \"update objects set `timestamp`=NOW() WHERE Object_Name IN ('\".join(\"','\", $changedRef).\"')\";","    query($sql);","","}","","function zapravkaReset() {","//    unlink(F_FUEL_SPEED);","    for($k=1;$k<=3;$k++) {","        setKolonkaVolume($k, 0);","        for($f=1;$f<=3;$f++) {","            gunInActivate($k, $f);","            gunSetPomp($k, $f, false);","        }","    }","    for($f=1;$f<=3;$f++) {","        setTankVolume($f, MAX_FUEL_LEVEL);","    }","}"]}]]},"ace":{"folds":[],"scrolltop":1993,"scrollleft":0,"selection":{"start":{"row":236,"column":25},"end":{"row":236,"column":25},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":141,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1613575662264}